# Frontend (React + Vite) — SPA клиент для Time Slot

Этот каталог содержит клиентское приложение на React + Vite, которое реализует:

- лендинг‑страницу продукта;
- личный кабинет мастера с управлением слотами, услугами и профилем;
- публичные страницы расписания (`/master/:id`);
- авторизацию через связку веба и Telegram;
- админскую панель для просмотра статистики, пользователей, слотов, услуг и записей.

Фронтенд спроектирован как **одностраничное приложение (SPA)** с клиентским роутингом, кэшированием запросов и продуманной интеграцией с backend‑API.

## Порт и dev‑proxy

- Dev‑сервер Vite: `http://localhost:5173`
- В `vite.config.js` настроен proxy:
  - `/user`, `/slot`, `/record`, `/admin`, `/service`, `/notification` → `http://localhost:8090`

Это позволяет в режиме разработки обходиться без CORS‑настроек на бэкенде.

## Быстрый старт

```bash
cd frontend/react-vite
npm install
npm run dev
```

Приложение будет доступно на `http://localhost:5173`.

Билд и предпросмотр:

```bash
npm run build
npm run preview
```

## Технологии

- **React** (функциональные компоненты, hooks)
- **React Router** — клиентский роутинг
- **@tanstack/react-query** — запросы к API, кэширование, фоновой рефреш
- **Axios** — HTTP‑клиент (`src/utils/api.js`)
- **Vite** — сборка и dev‑сервер
- Отдельные CSS‑файлы для страниц и компонентов

## Структура проекта

```text
frontend/
  react-vite/
    index.html           # HTML‑точка входа
    vite.config.js       # Vite + proxy к backend API
    package.json
    public/              # Публичные ассеты (favicon, иконки)
    src/
      main.jsx           # Создание корня React и BrowserRouter
      App.jsx            # Определение всех маршрутов приложения
      index.css          # Базовые стили и reset

      config/
        env.js           # Работа с переменными окружения Vite (VITE_*)

      utils/
        api.js           # Axios‑обертка и apiService.* для user/slot/record/service/admin
        auth.js          # Работа с localStorage и текущим пользователем
        timeUtils.js     # Форматирование дат/времени, таймзоны
        phoneUtils.jsx   # Маска и валидация телефона (+7 ...)

      components/
        Header/          # Хедер с навигацией
        Footer/          # Футер
        Sidebar/         # Общий layout с левым/правым сайдбаром
        LeftSidebar/     # Меню навигации по разделам
        RightSidebar/    # Блоки информации/рекламы
        Toast/           # Система уведомлений (контекст + компонент)
        waitAccess/      # Компонент экрана ожидания Telegram‑подтверждения

      pages/
        Home/            # Главная (лендинг)
        Login/           # Страница логина + экран ожидания
        Auth/            # Вспомогательные компоненты для авторизации
        Profile/         # Профиль мастера, управление слотами, услугами и аккаунтом
        MasterPublic/    # Публичное расписание мастера (/master/:id)
        Admin/           # Админ‑панель и страница логина админа
        Slots/           # Дополнительная страница работы со слотами
        About/           # Страница \"О сервисе\"
        Help/            # Помощь / FAQ
        Legal/           # Правовые документы (политика, оферта)
        NotFound/        # 404‑страница
```

## Роутинг и страницы

Маршруты описаны в `src/App.jsx` и строятся вокруг нескольких ключевых сценариев:

- `/` — **главная страница** (`Home`):

  - лендинг продукта и объяснение ценности сервиса;
  - CTA‑кнопка \"Начать работу\" → `/profile`.
- `/login` — **авторизация по телефону**:

  - форма ввода номера телефона;
  - запрос `POST /user/login`;
  - после успешного запроса — редирект на `/login/wait`.
- `/login/wait` — **экран ожидания Telegram‑подтверждения**:

  - показывает пользователю, что нужно подтвердить вход в Telegram‑боте;
  - периодически проверяет статус через backend (см. `apiService.user`).
- `/profile` — **профиль мастера**:

  - данные пользователя (имя, фамилия, контакты);
  - управление услугами (создание/редактирование/удаление);
  - создание слотов с учетом длительности услуги;
  - просмотр и редактирование заявок на слоты;
  - публичные и приватные данные аккаунта, запрос на удаление аккаунта.
- `/master/:telegramIdOrUUID` — **публичное расписание мастера**:

  - доступно без авторизации;
  - фильтрация по дате и услуге;
  - отображение статуса слота: свободен, забронирован, уже есть заявка и т.п.;
  - создание заявок для авторизованных пользователей (клиентов).
- `/admin/login` — **логин администратора**:

  - ввод пароля администратора;
  - сохранение admin‑токена в `localStorage` и установка времени жизни сессии.
- `/admin/dashboard` — **админ‑панель**:

  - сводная статистика по пользователям, слотам, записям, услугам и кликам по рекламе;
  - списки пользователей/слотов/услуг/записей с пагинацией и сортировкой;
  - детальные дроуеры (выезжающие панели) по пользователям, слотам, услугам и записям;
  - управление ролями пользователя и его статусом (active/inactive);
  - операции удаления пользователей, слотов и др.
- `/about`, `/help`, `/legal/*` — информационные и юридические страницы.
- `*` — `NotFound` — обработка несуществующих маршрутов.

## Работа с данными и API

### Axios + apiService

Все HTTP‑запросы инкапсулированы в `src/utils/api.js`:

- базовая конфигурация Axios (базовый URL, обработка ошибок);
- объекты вида `apiService.user`, `apiService.slot`, `apiService.record`,
  `apiService.service`, `apiService.admin` и т.д.;
- страницы используют только этот слой, а не \"голый\" Axios.

### React Query

React Query используется для:

- запроса слотов (`useQuery(["slots", userId], ...)`);
- выборки услуг мастера;
- загрузки заявок пользователя и записей по слоту;
- периодического refetch и фонового обновления данных;
- автоматической инвалидации кэша после мутаций (`queryClient.invalidateQueries(...)`).

Пример запроса слотов мастера:

```js
const { data: slotsResponse, isLoading } = useQuery({
  queryKey: ["slots", userId],
  queryFn: () => apiService.slot.getByMaster(userId).then(r => r.data),
  enabled: Boolean(userId),
  refetchInterval: 5000,
  refetchIntervalInBackground: true,
});
```

### Авторизация и сессия

- `src/utils/auth.js`:
  - хранение текущего пользователя (`user`) и токена в `localStorage`;
  - функции `getCurrentUser`, `setCurrentUser`, `isAuthenticated`, `handleLogout`.
- После подтверждения логина в Telegram backend возвращает пользователя и токен — фронт сохраняет это состояние и использует его при запросах.

## Логика профиля и слотов (кратко)

- Чтение слотов мастера:

  - `GET /slot/:master_id` — в web‑части используется `user.id` (UUID как `master_id`);
  - фронтенд нормализует полученные данные и группирует их по датам.
- Создание слота:

  ```text
  POST /slot/master/create
  {
    master_id: user.id,
    start_time: ISO‑строка,
    end_time: ISO‑строка,
    is_booked: false,
    service_id: <опционально>
  }
  ```

  - длительность по умолчанию берется из выбранной услуги;
  - при создании следующего слота используется окончание предыдущего как старт следующего.
- Массовое удаление:

  - `DELETE /slot/master/:master_id` — удаление всех слотов мастера (по UUID).
- После мутаций:

  - через React Query инвалидируются кэши слотов и услуг, UI автоматически обновляется.

## UI/UX и вспомогательные паттерны

- **Layout:**

  - единый лейаут с левым и правым сайдбаром (на основе `Sidebar`, `LeftSidebar`, `RightSidebar`);
  - адаптация под мобильные устройства (гамбургер‑меню, оверлеи).
- **Toast‑уведомления**:

  - контекст `ToastContext` и компонент `Toast` для успеха/ошибок/информационных сообщений;
  - используется во всех ключевых сценариях (создание слота, запись, ошибка API и т.д.).
- **Модальные окна**:

  - в профиле и на публичной странице мастера используются модалки для:
    - подтверждения записи;
    - редактирования статусов заявок;
    - подтверждения опасных действий (удаление аккаунта, слота, услуги).
- **Работа со временем**:

  - форматирование времени через `timeUtils` (`formatTimeInLocal`, `formatDateForDisplay` и др.);
  - человекочитаемые подписи для дат и интервалов.

## Переменные окружения (Vite)

Через Vite используются переменные `VITE_*` (см. `config/env.js` и рекомендации в `PROFESSIONAL_IMPROVEMENTS.md`):

- `VITE_API_URL` — базовый URL API (для продакшена);
- `VITE_PUBLIC_SITE_URL` — публичный URL сайта;
- дополнительные переменные (внутренние токены, режимы и т.п.) — через `.env` / `.env.example`.

Для локальной разработки, как правило, достаточно proxy в `vite.config.js`, без явного `VITE_API_URL`.
